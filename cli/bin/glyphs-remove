#!/usr/bin/env node

const parseArgs = require('minimist')
const inquirer = require('inquirer')
const { log, PRINT } = require('../utils/logger')
const { conf, localConfigs, hasConfig } = require('../utils/config')

const args = process.argv.slice(2)
const argv = parseArgs(args, {
  alias: {
    h: 'help'
  },
  boolean: ['h']
})

if (argv.help) {
  PRINT.REMOVE.HELP()
  process.exit()
}

const { _: [key] } = argv

;(async () => {
  log()

  if (!hasConfig) {
    log(`No icons files have been configured`, 1)
  } else {
    if (!key) {
      const choices = Object.entries(localConfigs)
        .map(([key, { name }]) => ({ value: key, name }))

      const questions = [{
        type: 'list',
        name: 'name',
        message: 'Select an icon set to remove',
        choices,
      }]

      const answers = await inquirer.prompt(questions)
      log()
      remove(localConfigs[answers.name])
    } else {
      const exists = !!conf.get(key)
      if (exists) {
        remove(localConfigs[key])
      } else {
        log(`No configuration with the key "${key}"`, 1)
      }
    }
  }
  log()
})()

function remove (set) {
  const { name, key } = set
  conf.delete(key)
  log(`Config for "${name}" set has been removed`, 1)
}
